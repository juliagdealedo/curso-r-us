---
title: "Introducci√≥n a R"
subtitle: "Crear c√≥digo en R, uso colaborativo y reproducible"
format: 
  revealjs:
    theme: solarized    
    smaller: true
    slide-number: true  
    self-contained: true
  html: 
    self-contained: true
    code-fold: true
    code-summary: "Show the code"
    code-tools: true
    toc: TRUE
    toc-location: left
    toc-depth: 3
    theme: flatly
---

## Bienvenidxs!!

¬øQui√©nes somos?\
¬øEn qu√© punto estamos?\
¬øD√≥nde queremos llegar?\

## Organizaci√≥n del curso

### Por d√≠a

Lunes = introducci√≥n a R, crear c√≥digo, buenas pr√°cticas\
Martes = manejo y visualizacion de datos\
Mi√©rcoles = modelos lineales y factoriales\
Jueves = modelos generalizados y multivariantes\
Viernes = uso colaborativo, dudas, ejemplos\

::::: columns
::: {.column width="50%"}
### Por hora

-   9:30 a 10:30 teor√≠a
-   10:30 a 11:15 ejercicios
-   11:15 a 11:30 break
-   11:30  a 12:30 teor√≠a
-   12:30 a 13:30 ejercicios y dudas
:::

::: {.column width="50%"}
### Hoy

-   Introducci√≥n, c√≥digo b√°sico
-   Ejercicios I
-   
-   Funciones, bucles, dataframes
-   Ejercicios II y III
:::
:::::

------------------------------------------------------------------------

## Lo que vas a aprender:

-   Mejorar la comprensi√≥n y la pr√°ctica estad√≠stica.

-   Desarrollar habilidades en programaci√≥n en R.

-   Aprender flujos de trabajo eficientes, limpios y reproducibles.

-   Saber buscar informaci√≥n

-   No enredarse en errores

## Lo que no vas a aprender:

-   A programar en plan pro sin mirar internet o chatgpt

-   A hacer p√°ginas web

-   A dejar de pelearte con la estad√≠stica

-   R es siempre woRk in progRess

## Llenos y vac√≠os de conocimiento

![WordCloud de la encuesta de este curso](images/wordcloud.png)

## Introducci√≥n

R es un lenguaje y entorno de programaci√≥n especializado en:

- An√°lisis estad√≠stico, visualizaci√≥n de datos y ciencia de datos.
- Es utilizado por investigadores, analistas y cient√≠ficos para explorar, modelar y comunicar informaci√≥n basada en datos de forma eficiente y reproducible.
- Muy utilizado en biolog√≠a 

![Bi√≥logxs en general](images/gato.png)

## R y RStudio

R ‚Üí Es el lenguaje de programaci√≥n y el motor que realiza los c√°lculos estad√≠sticos y el an√°lisis de datos.

RStudio ‚Üí Es un entorno de desarrollo integrado (un "programa") que facilita el uso de R con una interfaz amigable, con paneles, autocompletado y herramientas visuales.

![Ejemplo mesa de trabajo en R studio](images/studio.png)
 
## ¬øQu√© puede hacer R?

-   Calcular y analizar (operaciones matem√°ticas, modelos, simulaciones, tests)
-   Trabajar con datos (leer y escribir tablas, limpiar datos, transformar datos)
-   Visualizar (graficos estad√≠sticos, interactivos, mapas, animaciones, etc)
-   Automatizar y extender (crear funciones propias, desarrollar paquetes, reproducir analisis facilmente)
-   Comunicar (crear informes Quarto o RMarkdown, crear webs o apps Shiny)

![Ejemplo quarto](images/quarto.png){width="500px" height="550px" fig-align="left"}

# Lo b√°sico, b√°sico de R

## Operaciones aritm√©ticas

üì† Se hacen operaciones aritm√©ticas (como una calculadora): multiplicar, dividir, sumar, restar...\
por cierto, utilizamos la almohadilla # para silenciar o para comentar

```{r}
#| echo: true

2 + 3 # suma
10 - 4 # resta
3 * 5 # multiplicaci√≥n
20 / 4 # divisi√≥n
4 %% 2 # m√≥dulo (resto de una divisi√≥n)
2 ^ 4   # Potencias

```

***

## Operaciones b√°sicas de l√≥gica

Las operaciones l√≥gicas comparan valores y devuelven un resultado booleano (l√≥gico)\
TRUE o FALSE

```{r}
#| echo: true

20 / 4 >= 10    # ¬ø5 es mayor o igual que 10? 
20 / 4 == 10    # ¬ø5 es igual a 10?
20 / 4 < 10     # ¬ø5 es menor que 10? 


```

TRUE se comporta como 1 y FALSE como 0. \
Se pueden  usar en c√°lculos.

```{r}
#| echo: true

valores <- c (TRUE, FALSE, TRUE, TRUE)
sum(valores)       # cuenta cu√°ntos TRUE hay
mean(valores)      # proporci√≥n de TRUE


```

## Acumular informaci√≥n

La magia de los objetos
Indicamos un objeto con "<-"
```{r}
#| echo: true

x <- 10    
y <- 5
suma <- x + y
suma
suma + 7
```

### Espera, pero ¬øqu√© son los objetos?

- Son un poco "cualquier cosa"
- Tienen que empezar por una letra

## Tipos de objetos

Hay muchos tipos de objetos

-   vectores, strings, matrices, tablas, listas...
-   modelos, pol√≠gonos, funciones, mapas...

```{r}
#| echo: true

numero <- 1:10
numero
caracter <- "del uno al diez"
caracter
una_lista <- list(0:10, 10:20, 20:30)
una_lista
```

## Podemos transformar objetos de un tipo a otro

Cambiar de un tipo a otro con as.factor(), as.numeric(), as.character()


```{r}
#| echo: true

numeros_como_caracteres <- as.character(numero)
numeros_como_caracteres
numeros <- as.numeric(numeros_como_caracteres)
numeros
```

Ya iremos viendo m√°s ejemplos...

## Vectores

Vectores ('array') son elementos del mismo tipo juntos:
- Una secuencia de n√∫meros
- Una secuencia de nombres de especies

```{r}
#| echo: true

# un vector de cinco n√∫meros 
numeros <- c(1, 2, 3, 4, 6) 
numeros
# un vector del 1 al 40
otros_numeros <- 1:40
otros_numeros

```

### Operaciones con vectores

```{r}
#| echo: true
# sumamos un mismo valor a cada uno de los elementos del vector
otros_numeros + 10
```

## Ejercicio vectores
Genera de dos maneras distintas un vector de n√∫meros que vayan del 1 al 10

## Resolvemos
Genera de dos maneras distintas un vector de n√∫meros que vayan del 1 al 10

```{r}
#| echo: true

# Consecutivos 
1:10
# Combinando 
c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
# Generador de secuencias: del 0 al 10 cada 1 
seq(1, 10, 1)
```


## Operaciones con vectores

Se pueden hacer medias, multiplicaciones de objetos, seleccionar parte de un vector, etc

```{r}
#| echo: true
numeros
promedio <- mean(numeros)
promedio
promedio * numeros
promedio / numeros

# [ ] para seleccionar partes de un vector
(numeros / otros_numeros)[7]
(numeros / otros_numeros)[7:9] 

```

## Funciones b√°sicas y √∫tiles
Las funciones son aplicaciones que nos permiten realizar operaciones muy diversas.

Hay funciones ya de base de R (baseR) o en los paquetes ya creados por los usuarios (e.g. paquete dplyr)

## Funciones b√°sicas y √∫tiles
Las funciones son aplicaciones que nos permiten realizar operaciones muy diversas.

#### R base

```{r}
#| echo: true


# c () combinar
x <- c(4, 6, 8, 3, 9, 12, 12)

# Estad√≠sticos b√°sicos
mean(x)       # media
median(x)     # mediana
sd(x)         # desviaci√≥n est√°ndar
min(x)        # valor m√≠nimo
max(x)        # valor m√°ximo
range(x)      # rango (min, max)
summary(x)    # resumen general

```

## Ayuda
Ayuda para funciones en R (o tambi√©n vale buscar en google "function mean in R")


```{r}
#| echo: true

# Ayudas
?mean           # abre la ayuda de una funci√≥n
help(mean)      # lo mismo que '?mean'
??"dplyr"      # b√∫squeda m√°s amplia en toda la documentaci√≥n
```

![Ayuda](images/help.png)


## M√°s funciones b√°sicas y √∫tiles

Aleatoriedad, ordenar, contar...
```{r}
#| echo: true

x <- rpois(8, 8)
x
sample(x, 3)          # elegir 3 elementos al azar
rev(x)                # invertir el orden
sort(x)               # ordenar valores
length(x)             # longitud del vector
```

Conteos y valores √∫nicos
```{r}
#| echo: true

table(x)              # tabla de frecuencias
unique(x)             # valores √∫nicos
length(unique(x))     # cu√°ntos valores distintos
```

## M√°s funciones b√°sicas y √∫tiles

Raiz cuadrada, logaritmo, etc
```{r}
#| echo: true

log(x)       # logaritmo natural
sqrt(x)      # ra√≠z cuadrada
log10(x)     # logaritmo en base 10
abs(-0.23)   # Valores absolutos
round(0.1245, 2)     # redondear a 2 decimales

```


## Generadores de distribuciones

R es muy potente generando distribuciones con funciones ya integradas.\

- runif () - uniforme
- rnorm () - normal
- rpois () - poisson
- rbinom () - binomial negativa

Una distribuci√≥n describe c√≥mo se reparten los valores de una variable, c√≥mo de frecuentes son.

## Distribuci√≥n uniforme

N√∫meros al azar ‚Üí todos con la misma probabilidad

```{r}
#| echo: true

# Un vector de 5 n√∫meros aleatorios con distribuci√≥n uniforme
runif(5)

# 100 valores del 0 al 100
x <- runif(1000, min = 0, max = 100)
hist(x, col = "orange")

```

## Distribuci√≥n normal

Peso de personas ‚Üí muchas alrededor del promedio (forma de campana)

```{r}
#| echo: true

# 4 n√∫meros con una distribuci√≥n normal
rnorm(4)

# Especificando la media y la desviaci√≥n
x <- rnorm(1000, mean = 50, sd = 10)
hist(x, col = "skyblue")
```

## Distribuci√≥n poisson

Datos de conteo ‚Üí n√∫mero de especies

```{r}
#| echo: true

# Generar 5 observaciones con media (Œª) = 3
rpois(5, lambda = 3)

x <- rpois(1000, lambda = 3)
hist(x, col = "lightgreen")
```

## Distribuci√≥n binomial negativa
Resultados de ‚Äú√©xito o fracaso‚Äù (como lanzar una moneda) 
```{r}
#| echo: true

# Binomial
# 20 experimentos, en cada uno lanzamos una monedas, con una probabilidad de que salga cara del 50%
caras <- rbinom(200, size = 1, prob = 0.5)
table(caras)
barplot(table(caras), col = "steelblue")

```


## Caracteres y strings

R trabaja muy bien con cadenas de texto (strings)

```{r}
#| echo: true
un_nombre <- "Laura" # caracter
nombres <- c("Laura", "Rocio", "Violeta", "Rocio", "Rocio") # string
unique (nombres)
table (nombres)
rep (nombres, 5)    # repetir algo varias veces
sample (nombres, 3, replace=TRUE) 
```

## Caracteres y strings

Operaciones l√≥gicas

```{r}
#| echo: true
nombres
#¬øexiste Laura? ¬øHay algo que sea igual a Laura?
nombres == "Laura" 
# ¬øHay algo que sea desigual a Laura?
nombres != "Laura"
# ¬øEst√° inclu√≠do dentro de un vector de dos nombres?
nombres == c("Laura", "Rocio") #nope
nombres %in% c("Laura", "Rocio") #yes

```

El operador %in% se usa para comprobar si los elementos de un vector est√°n contenidos en otro vector

## Ejercicios

 1. Calcula el minimo valor de 100 valores aleatorios seg√∫n una distribuci√≥n normal\
 
 2. Dada una secuencia de 20 n√∫meros seguidos (del 0 al 20), genera los pares y gu√°rdalo en un objeto.\
 
 3.
  - Crea un vector con 20 n√∫meros aleatorios entre 0 y 50.
  - Calcula el promedio y la desviaci√≥n est√°ndar.
  - Multiplica todos los valores por 2.
  - Dibuja un histograma.
  - ¬øC√≥mo cambia el promedio despu√©s de multiplicar por 2?
  
  4. Crea un vector con edades y usa una comparaci√≥n para saber cu√°les son mayores de edad y cualcula cuantos no lo son
  
## Resolvemos

 1. Calcula el minimo valor de 100 valores aleatorios seg√∫n una distribuci√≥n normal\
```{r}
#| echo: true
min (rnorm (100))
```
 2. Dada una secuencia de 20 n√∫meros seguidos (del 0 al 20), genera los pares y gu√°rdalo en un objeto.\
```{r}
#| echo: true
pares <- seq (0, 20, 2)
```
 3. Ejercicio\

```{r}
#| echo: true
mi_vector <- runif(20,0,50)
mean (mi_vector)
sd (mi_vector)
mi_vector_2 <- mi_vector*2
hist(mi_vector_2)
```

***

4. Crea un vector con edades y usa una comparaci√≥n para saber cu√°les son mayores de edad y cualcula cuantos no lo son
```{r}
#| echo: true
edades <- c(12, 18, 3, 44, 25, 15, 30)
sum (edades > 18)
```


## Funciones propias

Sirven para **ejecutar** una tarea compleja y personalizada\

- Toma entradas (argumentos)
- Devuelve salidas (resultados)
- Sirve para organizar y simplificar el c√≥digo


Ventaja ante la complejidad: se puede reutilizar!!

## Ejemplo de funciones

Creamos nuestras propias funciones con function ()\
Muchas ejecuciones (i.e. tareas) distintas para un mismo vector.

```{r}
#| echo: true

# Queremos la media de nuestros n√∫meros  y la media de estos transformados a logaritmo
vector <- seq(1, 100, 10)
mean (log (vector))

# Queremos la desviaci√≥n est√°ndar de nuestros n√∫meros y de √©stos transformados a log
vector2 <- seq(1, 300, 50)
sd (log (vector2))

# Una funci√≥n que hace todo eso a la vez y m√°s cosas
mi_funcion_increible <- function (y) {
  mean <- mean (y)
  mean_log <- mean (log (y+1))
  sd <- sd (y)
  sd_log <- sd (log (y+1))
  return (c(mean, mean_log, sd, sd_log))
}

vector3 <- sample (40)
mi_funcion_increible (vector3)
mi_vector_increible <- mi_funcion_increible
mi_vector_increible
vector4 <- sample (100)
mi_funcion_increible (vector4)

```

## Bucles 

- Distintos a las funciones. Se usa la funci√≥n for()
- Un bucle (loop) sirve para **repetir** una acci√≥n varias veces.
- A cada repetici√≥n se le llama **iteraci√≥n**
- Se usa cuando quieres hacer lo mismo para muchos elementos (e.g. recorrer filas, listas o vectores).\

```{r}
#| echo: true

# A mano del 1 al 5 est√° bien... pero del 1 al 100?
for (i in 1:5) {
  print(paste("Aqu√≠ est√° el n√∫mero", i))
}


valores <- c(10, 20, 30, 40)

for (v in valores) {
  print(mean(log(v + 1)))
}

```

## la iteraci√≥n puede ser por string

```{r}
#| echo: true

nombres <- c ("Laura", "Rocio", "Violeta")

length(nombres) # n√∫mero de iteraciones 

for (i in nombres) {
  print(paste("Aqu√≠ est√° la alumna", i))
}

```

## Bucles II üé≤

Imaginemos que queremos tirar un dado

```{r}
#| echo: true

# un dado üé≤
sample(1:6, 1)

```
Queremos repetir la funci√≥n anterior 100 veces (tirar el dado 100 veces)\
üé≤üé≤üé≤üé≤üé≤üé≤üé≤üé≤üé≤üé≤üé≤üé≤üé≤ x 100
```{r}
#| echo: true

# Hay que generar un objeto vac√≠o

tiro <- c()

for (i in 1:100) {
  tiro[[i]] <- sample(1:6, 1)
}

unlist(tiro)

```
1. Ejercicio r√°pido: ¬øc√≥mo podemos saber cuantas veces ha salido el numero 2?

## Resolvemos
1. Ejercicio r√°pido: ¬øc√≥mo podemos saber cuantas veces ha salido el numero 2?
```{r}
#| echo: true

sum (tiro == 2)
```

## Ejercicio bucle

General 50 valores aleatorios generados a partir de una distribucion normal y calcula 100 medias, una para cada aleatorizaci√≥n con un bucle.

## Ejercicio bucle

General 50 valores aleatorios generados a partir de una distribucion normal y calcula 100 medias, una para cada aleatorizaci√≥n con un bucle.
```{r}
#| echo: true

# Crear un vector vac√≠o

filas <- c()

for (i in 1:100) {
  filas[[i]] <- mean (rnorm (50))
}

unlist(filas)

```

## Bucles III

Guardamos en un objeto las iteraciones

```{r}
#| echo: true

# Creamos un dataframe vac√≠o
tabla <- data.frame(numero = numeric(),
                    cuadrado = numeric())
tabla

# Creamos un bucle que vaya llenando las filas y columnas con cada i
for (i in 1:5) {
  nueva_fila <- data.frame(numero = i, cuadrado = i^2)
  tabla <- rbind(tabla, nueva_fila)
}

tabla

```

## Bucles con 'apply', 'sapply', 'lapply'

Otra forma de hacer bucles, pero en la misma linea

```{r}
#| echo: true
#| eval: false

sapply(vectores, function(i) mean(log(i + 1)))

```

## Condicionantes con 'ifelse'

- if (): R ejecuta el c√≥digo dentro del bloque {} solo si la condici√≥n es verdadera.\
- if else (): si no se cumple la condici√≥n, haz esto otro\
- ifelse (): en una linea\

```{r}
#| echo: true

x <- 10

if (x > 5) {
  print("El n√∫mero es mayor que 5")
}

x <- 3

if (x > 5) {
  print("El n√∫mero es mayor que 5")
} else {
  print("El n√∫mero es menor o igual que 5")
}

edades <- c(15, 22, 35, 12)
ifelse (edades >= 18, "Adulto", "Menor")

```

## Ejercicios

- Crea un vector con 10 temperaturas y usa ifelse() para clasificar cada valor como "Fr√≠o" o "Caluroso", seg√∫n tu termostato personal

- Opcional (y dif√≠cil). Haz una funci√≥n que diga si un n√∫mero cualquiera es par o no 

## Resolvemos

- Crea un vector con 10 temperaturas y usa ifelse() para clasificar cada valor como "Fr√≠o" o "Caluroso", seg√∫n tu termostato personal

- Haz una funci√≥n que diga si un n√∫mero cualquiera es par o no 

```{r}
#| echo: true

temperaturas <- rpois (10, 15)
clasificacion <- ifelse(temperaturas < 15, "frio", "caliente")
data.frame (temperaturas, clasificacion)

que_tipo_de_numero_soy <- function (x) {
ifelse(x %% 2 == 0, "par", "impar")
}

que_tipo_de_numero_soy(2)
que_tipo_de_numero_soy(33)

```

## Bases de datos

Una base de datos (data frame) es una tabla de datos, como una hoja de c√°lculo en excel, tiene filas (observaciones) y columnas (variables).

```{r}
#| echo: true

# Creamos vectores con informaci√≥n
nombres <-  c ("Laura", "Rocio", "Violeta")
edad <- c(23, 35, 29)
altura <- c(1.65, 1.80, 1.70)
profesion <- c("Bi√≥loga", "Inform√°tica", "M√©dica")

# Combinamos todo en un data frame
personas <- data.frame(
  NAME = nombres,
  AGE = edad,
  HEIGHT = altura,
  JOB = profesion)

personas

```

## Seleccionar con R base
Seleccionamos filas, columnas sobre la base de datos 

objeto[filas,columnas]

```{r}
#| echo: true

personas[1,] # FILAS
personas[,1] # COLUMNAS
personas$NAME # Seleccionar columnas directamente con $

# head(personas)       
# str(personas)  
# summary(personas) 
# colnames(personas) 
# nrow(personas)  
# ncol(personas)
# View(personas) se abre en RStudio como una tabla interactiva.
# write_csv(personas, "data/personas.csv")

```

![tabla vista en R (View)](images/view.png)

## Leer bases de datos

![üôè Organiza correctamente tus carpetas üôè ](images/folders.png){width="200px" height="250px" fig-align="left"}

/ para indicar un nivel m√°s dentro de la carpeta

En la pr√°ctica, los datos vienen en archivos externos: CSV, Excel, TXT, u online. \
El formato .csv (comma separated values) es el m√°s com√∫n.
Cada columna est√° separada por una coma o punto y coma.

## Leer bases de datos

here () nos lleva a donde tengamos el archivo del script guardado

```{r}
#| echo: true

library(here)

# dir()
# getwd ()
# setwd ()

# CSV
datos_csv <- read.csv(here("data/personas.csv"))
head(datos_csv)

# EXCEL
library(readxl)
datos_excel <- read_excel(here("data/herbarium_df.xlsx")) #, sheet = 1 podr√≠amos especificar el numero de hoja

# GOOGLE SHEETS
library(googlesheets4)
datos_gs <- read_sheet("https://docs.google.com/spreadsheets/d/1qC4lsXPpEcX1NmLdwiMJMC8X_WKX-EFQm4ahPdrNCZc/edit?usp=sharing")

```
## Guardar bases de datos

```{r}
#| echo: true
#| eval: false 

write.xlsx (datos_gs, "data/datos_gs.xlsx")
write_csv (datos_gs, "data/datos_gs.csv")
fwrite (datos_gs, "data/datos_gs.csv")
```

## Ejercicio

Base de datos de flores: Por cada sitio y trampa, tenemos el numero de flores que tienen las especies de plantas en Do√±ana. 

Ejercicio: Importa la base de datos "flores.csv" de la carpeta "data", explora la base de datos, calcula la abundancia media de flores total, indica cuantas especies distintas hay de plantas. Luego, crea una base de datos con el n√∫mero de individuos por especie (no de flores). Guardala como csv.

## Resolvemos

```{r}
#| echo: true


flores <- read.csv(here("data/flores.csv"))
str(flores) # exploramos
mean(flores$abundance) # media
length(unique(flores$species)) # cuantas especies hay
# table(flores$species) # cuantas flores por especie
flores_sum <- data.frame(table(flores$species)) # n√∫mero de individuos por especie
# write_csv (flores_sum, "data/flores_sum.csv")
```

## Buenas pr√°cticas de sintaxis en R

::::: columns
::: {.column width="50%"}
#### Espacios y asignaciones

-   Usa espacios alrededor de los operadores, usa <- en vez de = 
-   Funciones con el mismo nombre, especifica el paquete (dplyr::select ())
-   Empieza tu script con una descripci√≥n sobre lo que hace el c√≥digo, autorx, fecha y sesi√≥n.

#### Registro y reproducibilidad

-   Realiza todas las manipulaciones de datos mediante c√≥digo, no manualmente
-   As√≠ dejas rastro reproducible de cada cambio
-   Guarda o exporta tus datos en formatos de texto plano (.csv, .txt)
:::

::: {.column width="50%"}
![üôè c√≥mo organizar tus carpetasüôè ](images/folders.png)
:::
:::::


## C√≥digo limpio

-   Comentarios √∫tiles
-   Divide en pasos l√≥gicos
-   Usa bien la sangr√≠a y los espacios
-   Usa bien los nombres
-   Guarda solo objetos √∫tiles (R se va llenando)
-   Guarda una carpeta con los datos brutos

## Tips

-   control + shift + C (des)comenta todo a la vez ##
-   control + shift + A reformatea el c√≥digo
-   control + click se abre la tabla en RStudio

### Objetos

- Siempre empiezan por una letra y son sensibles a mayusculas
- Deber√≠an llevar nombres coherentes y un orden

```{r}
#| echo: true

yo_uso_la_serpiente <- 10
OtraGenteUsaElCamello <- 9
otra.gente.usa.los.puntos <- 9
Hayque_evitar.esto10 <- 2

```


## Compartir c√≥digo

-   git. Es una herramienta de control de versiones que adem√°s permite trabajar en equipo
-   GitHub (portfolio de programador) ![Perfil](images/github.png)

------------------------------------------------------------------------

## Escribir textos, informes, art√≠culos

-   Quarto
-   Rmarkdown
-   Ciencia reproducible y limpia



