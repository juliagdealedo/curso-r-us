---
title: "Introducci√≥n a R"
subtitle: "Crear c√≥digo en R, uso colaborativo y reproducible"
format: 
  revealjs:
    theme: solarized    
    smaller: true
    slide-number: true  
    self-contained: true
  html: 
    self-contained: true
    code-fold: true
    code-summary: "Show the code"
    code-tools: true
    toc: TRUE
    toc-location: left
    toc-depth: 3
    theme: flatly
---

## Bienvenidxs!!

¬øQui√©nes somos?

## Organizaci√≥n del curso

### Por d√≠a

Lunes = introducci√≥n a R, crear c√≥digo, buenas pr√°cticas\
Martes = manejo y visualizacion de datos\
Mi√©rcoles = modelos lineales y factoriales\
Jueves = modelos generalizados y multivariantes\
Viernes = uso colaborativo, dudas, ejemplos\

::::: columns
::: {.column width="50%"}
### Por hora

-   9:30 a 10:30 teor√≠a
-   10:30 a 11:15 ejercicios
-   11:15 a 11:30 break
-   11 a 12:30 teor√≠a
-   12 a 13:30 ejercicios y dudas
:::

::: {.column width="50%"}
### Hoy

-   Introducci√≥n, c√≥digo b√°sico
-   Ejercicios I
-   
-   Funciones, bucles, dataframes
-   Ejercicios II y III
:::
:::::

------------------------------------------------------------------------

## Lo que vas a aprender:

-   Mejorar la comprensi√≥n y la pr√°ctica estad√≠stica.

-   Desarrollar habilidades en programaci√≥n en R.

-   Aprender flujos de trabajo eficientes, limpios y reproducibles.

-   Saber buscar informaci√≥n

-   No enredarse en errores

## Lo que no vas a aprender

-   A programar en plan pro sin mirar internet o chatgpt

-   A hacer p√°ginas web

-   A dejar de pelearte con la estad√≠stica

## Objetivos de la clase

![WordCloud](images/wordcloud.png)

## Introducci√≥n

R es un lenguaje y entorno de programaci√≥n especializado en:

An√°lisis estad√≠stico, visualizaci√≥n de datos y ciencia de datos.

Utilizado por investigadores, analistas y cient√≠ficos para explorar, modelar y comunicar informaci√≥n basada en datos de forma eficiente y reproducible.

Muy utilizado en biolog√≠a

![Bi√≥logxs en general](images/gato.png)

## R y Rtudio

R ‚Üí Es el lenguaje de programaci√≥n y el motor que realiza los c√°lculos estad√≠sticos y el an√°lisis de datos.

RStudio ‚Üí Es un entorno de desarrollo integrado (un programa) que facilita el uso de R con una interfaz amigable, paneles, autocompletado y herramientas visuales.

![Ejemplo mesa de trabajo](images/studio.png)
 
## ¬øQu√© puede hacer R?

-   Calcular y analizar (operaciones matem√°ticas, modelos, simulaciones, tests...)
-   Trabajar con datos (leer y escribir tablas, limpiar datos, transformar datos)
-   Visualizar (graficos estad√≠sticos, interactivos, mapas, animaciones, etc)
-   Automatizar y extender (crear funciones propias, desarrollar paquetes, reproducir analisis facilmente)
-   Comunicar (crear informes Quarto o RMarkdown, crear webs o apps Shiny)

![Ejemplo quarto](images/quarto.png){width="500px" height="550px" fig-align="left"}


***

## Workflow: lo b√°sico b√°sico

üì† Se hacen operaciones aritm√©ticas (como una calculadora) se pueden hacer operaciones b√°sicas multiplicar, dividir, sumar, restar...

```{r}
#| echo: true

2 + 3     
10 - 4    
3 * 5     
20 / 4    
```

***

## Operaciones b√°sicas de l√≥gica

Las operaciones l√≥gicas comparan valores y devuelven un resultado l√≥gico.\

TRUE se comporta como 1 y FALSE como 0. Se pueden sumar o usar en c√°lculos.

```{r}
#| echo: true

20 / 4 >= 10    # ¬ø5 es mayor o igual que 10? ‚Üí FALSE
20 / 4 == 10    # ¬ø5 es igual a 10? ‚Üí FALSE
20 / 4 < 10     # ¬ø5 es menor que 10? ‚Üí TRUE


valores <- c(TRUE, FALSE, TRUE, TRUE)
sum(valores)       # cuenta cu√°ntos TRUE hay
mean(valores)      # proporci√≥n de TRUE

```


## Acumular informaci√≥n

La magia de los objetos

```{r}
#| echo: true

x <- 10    
y <- 5
suma <- x + y
suma
suma + 7
```

### Espera, pero ¬øqu√© son los objetos?

Los objetos empiezan por una letra

Son sensibles a mayusculas

Tienen que llevar nombres coherentes y un orden

```{r}
#| echo: true

yo_uso_la_serpiente <- 10
OtraGenteUsaElCamello <- 9
otra.gente.usa.los.puntos <- 9
Hayque_evitar.esto10 <- 2

```

## Tipos de objetos

Hay muuchos tipos de objetos

-   num√©ricos, caracteres, matrices, tablas, listas
-   modelos, pol√≠gonos, funciones

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.5em'"
numero <- 1:10
numero
caracter <- "del uno al diez"
caracter
una_lista <- list(1:10, 11:20, 21:30)
una_lista
```

## Podemos transformar objetos de un tipo en otro con as.xxxx()

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"
numeros_como_caracteres <- as.character(numero)
numeros_como_caracteres
numeros <- as.numeric(numeros_como_caracteres)
numeros
```

## Vectores y operaciones con vectores

Creamos vectores, que son elementos del mismo tipo juntos (num√©rico, car√°cter). Es un poco como una fila de una tabla... se pueden crear con 1:10 (numeros del 1 al 10)

Consecutivos del 1:10

Combinando c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)

Generador de secuencias: del 0 al 100 cada 10 seq(0, 100, 10)

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"

numeros <- c(1, 2, 3, 4, 5) 
numeros
otros_numeros <- 1:40
otros_numeros
otros_numeros + 10
promedio <- mean(numeros)
promedio
promedio * numeros
numeros / otros_numeros
# [ ] para seleccionar partes de un vector o una tabla
(numeros / otros_numeros)[8]

```

## Generadores de distribuciones

R es muy potente generando distribuciones.\
Una distribuci√≥n describe c√≥mo se reparten los valores de una variable.\

N√∫meros al azar ‚Üí todos con la misma probabilidad UNIFORME 
### Ejemplo Distribuci√≥n uniforme
```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"


# Un vector de 5 n√∫meros aleatorios con distribuci√≥n uniforme
runif(5)
# Ahora que 3 n√∫meros vayan del 0 al 100
runif(3, min=0, max=100)
# C√≥mo se ve
x <- runif(1000, min = 0, max = 100)
hist(x, col = "orange", main = "Distribuci√≥n uniforme", xlab = "N√∫mero de eventos", ylab = "Frecuencia")

```

## Distribuci√≥n normal
Peso de personas ‚Üí muchas alrededor del promedio (forma de campana) NORMAL 
```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"

# 4 n√∫meros con una distribuci√≥n normal
rnorm(4)

# Especificando la media y la desviaci√≥n
x <- rnorm(1000, mean = 50, sd = 10)
hist(x, col = "skyblue", main = "Distribuci√≥n normal", xlab = "N√∫mero de eventos", ylab = "Frecuencia")
```

## Distribuci√≥n poisson
Conteo POISSON 
```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"
#| 
# Generar 1000 observaciones con media (Œª) = 3
x <- rpois(1000, lambda = 3)

# Ver las primeras observaciones
head(x)

# Histograma
hist(x, col = "lightgreen", main = "Distribuci√≥n de Poisson (Œª = 3)", xlab = "N√∫mero de eventos", ylab = "Frecuencia")

```

## Distribuci√≥n binomial negativa
Resultados de ‚Äú√©xito o fracaso‚Äù (como lanzar una moneda) BINOMIAL
hace fala??????
```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"
# Binomial
# 20 experimentos, en cada uno lanzamos una monedas, con una probabilidad de que salga cara del 50%
caras <- rbinom(200, size = 1, prob = 0.5)
table(caras)
barplot(table(caras), col = "steelblue")

```

## Funciones b√°sicas y √∫tiles
Las funciones son aplicaciones que nos permiten realizar operaciones muy diversas.

-   Funciones que vienen con la distribucioÃÅn base de R o en los paquetesya creados por los usuarios
```{r}
#| echo: true
#| attr-source: "style='font-size: 0.6em'"
#| attr-output: "style='font-size: 0.5em'"


# c () concatenar
x <- c(4, 6, 8, 3, 9, 12, 12)

# Estad√≠sticos b√°sicos
mean(x)       # media
median(x)     # mediana
sd(x)         # desviaci√≥n est√°ndar
min(x)        # valor m√≠nimo
max(x)        # valor m√°ximo
range(x)      # rango (min, max)
summary(x)    # resumen general

```

## Ayuda
Ayuda para funciones en R (o tambi√©n vale buscar en google "function mean in R")

```{r}
#| echo: true

# Ayudas
?mean           # abre la ayuda de una funci√≥n
help(mean)      # lo mismo que '?mean'
??"normal"      # b√∫squeda m√°s amplia en toda la documentaci√≥n
```

## Mas funciones b√°sicas y √∫tiles
Aleatoriedad
```{r}
#| echo: true
#| attr-source: "style='font-size: 0.6em'"
#| attr-output: "style='font-size: 0.5em'"
x <- rpois(8, 8)
x
sample(x, 3)          # elegir 3 elementos al azar
rev(x)                # invertir el orden
sort(x)               # ordenar valores
```

Conteos y valores √∫nicos

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.6em'"
#| attr-output: "style='font-size: 0.5em'"
length(x)             # longitud del vector
table(x)              # tabla de frecuencias
unique(x)             # valores √∫nicos
length(unique(x))     # cu√°ntos valores distintos
sample(x, 3, replace=TRUE) 
round(mean(x), 2)     # redondear a 2 decimales
```
***
Nombres y texto
```{r}
#| echo: true

nombres <- c("Laura", "Rocio", "Violeta", "Rocio", "Rocio")
unique (nombres)
table (nombres)
rep (nombres, 5)    # repetir algo varias veces
sample(nombres, 3, replace=TRUE) 
```

## Ejercicios I

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"
# 1. Calcula el minimo valor de 100 valores aleatorios seg√∫n una distribuci√≥n normal
min (rnorm (100))

# 2. Dada una secuencia de 20 n√∫meros seguidos (del 0 al 20), genera los pares y gu√°rdalo en un objeto.
pares <- seq (0, 20, 2)

# 3. Ejercicio:

  # Crea un vector con 20 n√∫meros aleatorios entre 0 y 50.
  # Calcula el promedio y la desviaci√≥n est√°ndar.
  # Multiplica todos los valores por 2.
  # Dibuja un histograma.
  #¬øC√≥mo cambia el promedio despu√©s de multiplicar por 2?

mi_vector <- runif(20,0,50)
mean (mi_vector)
sd (mi_vector)
mi_vector_2 <- mi_vector*2
hist(mi_vector_2)

# Crea un vector con edades y usa una comparaci√≥n para saber cu√°les son mayores de edad y cualcula cuantos no lo son
edades <- c(12, 18, 3, 44, 25, 15, 30)
sum (edades > 18)

```

## Crear funciones

-   Crear nuestras propias funciones con function().
-   Asignarle un nombre
-   Indicar argumentos
-   Escribir entre llaves el coÃÅdigo

## Ejemplo de funciones

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"

# Queremos la media de nuestros n√∫meros transformados a logaritmo

vector <- seq(1, 100, 10)
mean (log (vector))
sd (log (vector))

# Queremos hacerlo otra vez con otros valores

vector2 <- seq(1, 300, 50)
mean (log (vector2))
sd (log (vector2))

log_vect <- function (y) {
  mean_y <- mean (log (y+1))
  sd_y <- sd (log (y+1))
  print(paste("La media es", mean_y, 
              ", la desviaci√≥n est√°ndar es:", round(sd_y,2)))
  return(log(y))
}

vector3 <- seq(1, 300, 4)
distribution = log_vect (vector3)
hist(distribution)

```

## Bucles - for ()

R repite algo autom√°ticamente sin que lo escribas varias veces. 

[Aqu√≠ est√° el n√∫mero 1)]{style="font-size: 0.9em !important;"}
[Aqu√≠ est√° el n√∫mero 2)]{style="font-size: 0.9em !important;"}
[Aqu√≠ est√° el n√∫mero 3)]{style="font-size: 0.9em !important;"}
[Aqu√≠ est√° el n√∫mero 4)]{style="font-size: 0.9em !important;"}
[Aqu√≠ est√° el n√∫mero 5)]{style="font-size: 0.9em !important;"}

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"

# i puede ser un n√∫mero
length(1:5) # n√∫mero de iteraciones 
for (i in 1:5) {
  print(paste("Aqu√≠ est√° el n√∫mero", i))
}

# i puede ser un caracter 
nombres <- c ("Laura", "Rocio", "Violeta")
length(nombres) #n√∫mero de iteraciones 
for (i in nombres) {
  print(paste("Aqu√≠ est√° la alumna", i))
}

```

## Bucles II
Con un dado ahora

```{r}
#| echo: true

# un dado
sample(1:6, 1)
# i puede ser solo el numero de veces que repetimos algo
resultados <- c()
for (i in 1:100) {
  tiro <- sample(1:6, 1)
  resultados <- c(resultados, tiro)
}

resultados
mean(resultados)

# 1. Ejercicio: como podemos saber cuantas veces ha salido el numero 2?
sum(resultados==2)

```

## Volvemos a nuestro ejemplo

```{r}
#| echo: true

# Queremos repetir el c√°lculo de media y desviaci√≥n logar√≠tmica

# para varios vectores distintos

vectores <- list (seq(1, 100, 10), seq(1, 300, 50), seq(1, 500, 100))

# Creamos un bucle FOR

for (i in vectores) {
media <- mean(log(i + 1))
desv  <- sd(log(i + 1))
print(paste("Media:", round(media, 2), " | Desviaci√≥n:", round(desv, 2)))
}

# Ahora queremos guardar los resultados

# Crear un vector vac√≠o

resultados <- c()

for (i in vectores) {
media <- mean(log(i + 1))
desv  <- sd(log(i + 1))
filas <- data.frame(media=media, desv=desv)
resultados <- rbind(resultados, filas)
}

resultados


```

## Apply, sapply, lapply

Otra forma de hacer bucles, pero en la misma linea

```{r}
#| echo: true

sapply(vectores, function(i) mean(log(i + 1)))


```

## ifelse

Condicionantes

if: R ejecuta el c√≥digo dentro del bloque {} solo si la condici√≥n es verdadera.\
if // else: si no se cumple la condici√≥n, haz esto otro\
ifelse: en una linea\

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.5em'"

x <- 10

if (x > 5) {
  print("El n√∫mero es mayor que 5")
}

x <- 3

if (x > 5) {
  print("El n√∫mero es mayor que 5")
} else {
  print("El n√∫mero es menor o igual que 5")
}

edades <- c(15, 22, 35, 12)

ifelse(edades >= 18, "Adulto", "Menor")


```

## Ejercicios 2

4. Haz una funci√≥n que diga si un n√∫mero cualquiera es par o no 

5. Crea un vector con 10 temperaturas y usa ifelse() para clasificar cada valor como "Fr√≠o" o "Caluroso", segun lo que tu consideres

```{r}
#| echo: true

que_tipo_de_numero_soy <- function (x) {
ifelse(x %% 2 == 0, "par", "impar")
}

temperaturas <- rpois (10, 15)
clasificacion <- ifelse(temperaturas < 15, "frio", "caliente")
# Crea una tabla con esta clasificaci√≥n 
data.frame (temperaturas, clasificacion)


```

## Bases de datos

Una base de datos (data frame) es una tabla de datos, como una hoja de c√°lculo en excel, tiene filas (observaciones) y columnas (variables).

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"

# Creamos vectores con informaci√≥n
nombres <-  c ("Laura", "Rocio", "Violeta")
edad <- c(23, 35, 29)
altura <- c(1.65, 1.80, 1.70)
profesion <- c("Bi√≥loga", "Profesora", "M√©dica")

# Combinamos todo en un data frame
personas <- data.frame(
  NAME = nombres,
  AGE = edad,
  HEIGHT = altura,
  JOB = profesion)

personas[1,]
personas[,1]
personas$NAME # Seleccionar columnas con $

# head(personas)       
# str(personas)  
# summary(personas) 
# colnames(personas) 
# nrow(personas)  
# ncol(personas)
# View(personas) se abre en RStudio como una tabla interactiva.
# write_csv(personas, "data/personas.csv")

```

![tabla vista en R (View)](images/view.png)

## Leer bases de datos

En la pr√°ctica, los datos vienen archivos externos:CSV, Excel, TXT, o bases de datos online. 
El formato .csv (comma separated values) es el m√°s com√∫n. Cada columna est√° separada por una coma o punto y coma.

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"
library(here)
# CSV
datos_csv <- read.csv(here("data/personas.csv"))
head(datos_csv)
# EXCEL
library(readxl)
datos_excel <- read_excel(here("data/herbarium_df.xlsx")) #, sheet = 1 podr√≠amos especificar el numero de hoja
head(datos_excel)
# GOOGLE SHEETS
library(googlesheets4)
datos_gs <- read_sheet("https://docs.google.com/spreadsheets/d/1qC4lsXPpEcX1NmLdwiMJMC8X_WKX-EFQm4ahPdrNCZc/edit?usp=sharing")
head(datos_gs)
# write_csv(datos_gs, "data/datos_gs.csv")
# fwrite(datos_gs, "data/datos_gs.csv")
```

## Ejercicios 3

Base de datos de flores: Por cada sitio y pantrap, tenemos el numero de flores que tienen las especies de plantas en Do√±ana. 
code = c√≥digo de la planta

Ejercicio: Importa la base de datos "flores.csv" de la carpeta "data", explora la base de datos, calcula la abundancia media de flores total, indica cuantas especies distintas hay de plantas. Luego, crea una base de datos con el n√∫mero de individuos por especie (no de flores). Guardala como csv.

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.5em'"
#| attr-output: "style='font-size: 0.3em'"


flores <- read.csv(here("data/flores.csv"))
str(flores)
mean(flores$abundance)
length(unique(flores$species))
table(flores$species)
unique(flores$species)
data.frame(table(flores$species))
#write_csv (flores, "data/flores.csv")
```

## Compartir c√≥digo

-   git. Es una herramienta de control de versiones que adem√°s permite trabajar en equipo
-   GitHub (portfolio de programador) ![Perfil](images/github.png)

------------------------------------------------------------------------

## Escribir textos, informes, art√≠culos

-   Quarto
-   Rmarkdown
-   Ciencia reproducible y limpia

## Bibliograf√≠a

[cookbook](http://www.cookbook-r.com/) 
