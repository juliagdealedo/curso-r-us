---
title: "Introducción a R"
subtitle: "Crear código en R, uso colaborativo y reproducible"
format: 
  revealjs:
    theme: white    # Specify the 'night' theme here
    slide-number: true  # Optional: Show slide numbers
    self-contained: true
  html: 
    self-contained: true
    code-fold: true
    code-summary: "Show the code"
    code-tools: true
    toc: TRUE
    toc-location: left
    toc-depth: 3
    theme: flatly
---

## Manejo de datos

```{r}
#| echo: true

library(here)
library(tidyverse)
library(tm)
library(wordcloud2)
library(readxl)

datos_curso = read_excel(here("data/datos-curso.xlsx"))

str(datos_curso)
```
------------------------------------------------------------------------

```{r}
colnames(datos_curso)
```

------------------------------------------------------------------------

```{r}
#| echo: true
#| attr-source: "style='font-size: 0.6em'"
#| attr-output: "style='font-size: 0.2em'"
#| fig-width: 3     # ancho en pulgadas
#| fig-height: 3    # alto en pulgadas
#| fig-align: "center"

datos_curso_filtrado <- datos_curso |>
  rename (curso = "Curso de la primera matrícula en el programa de doctorado",
         experiencia = "Cuéntanos tu experiencia con R",
         comentarios = "Observaciones",
         email = "Correo electrónico") |>
  select (curso, experiencia, comentarios, email) |>
  mutate (email = str_replace(email, "anonymous", "anónimo")) |>
  filter (curso == "2022-23")
  
words <- tolower(
                unlist(
                  strsplit(datos_curso_filtrado$experiencia, " ") ) ) 

words <- gsub("[[:punct:][:digit:]]", "",words)
stop_es <- stopwords("spanish")
words_clean <- words[!words %in% stop_es]

# Plot
wordcloud2(data=table(words_clean), size=1,
           color = rep(RColorBrewer::brewer.pal(11, "PRGn"), 20))


```

```{r}
# 1. Cargar librerías
library(dplyr)
library(ggplot2)
library(readr)
library(palmerpenguins)

# 2. Leer datos
data(package = 'palmerpenguins')
datos <- penguins
# 3. Explorar
head(datos)
summary(datos)

# 4. Limpiar: eliminar filas con NA
datos_limpios <- datos %>% 
  filter(!is.na(body_mass_g))

# 5. Transformar: crear nueva variable
datos_limpios <- datos_limpios %>%
  mutate(body_mass_kg = body_mass_g / 1000)

# 6. Visualizar: gráfico simple
ggplot(datos_limpios, aes(x = species, y = body_mass_kg, fill = species)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Peso corporal por especie de pingüino",
       x = "Especie", y = "Peso (kg)")

```
## Visualizacion de datos

DATA VIZZZZZZ
------------------------------------------------------------------------

## Desde gráficos muy simples
```{r}
plot(x=rnorm(100), y=rnorm(100))
```

------------------------------------------------------------------------

## Hasta gráficos muy complejos
![quién habla con quién en "The Office"](images/complex_graph.png)
[Código](https://r-graph-gallery.com/character-interaction-analysis.html)


#### Datos georeferenciados

```{r}
#| echo: true

library(rgbif)
library(ggplot2)
library(rnaturalearth)
library(sf)

datos <- occ_search(scientificName = "Lynx pardinus", limit = 100)
#head(datos$data[, c("species", "decimalLatitude", "decimalLongitude")])
df <- datos$data

# Basic map
world <- ne_countries(scale = "medium", returnclass = "sf")

# Plot
ggplot() +
  geom_sf(data = world, fill = "black", color = "grey30") +
  geom_point(data = df, aes(x = decimalLongitude, y = decimalLatitude),
             color = "darkred", size = 2, alpha = 0.7) +
  coord_sf() +
  theme_minimal()

```

***

```{r}
#| echo: true

# Basic map
spain <- ne_countries(country=c("spain", "portugal"))
plot(spain)
# Plot

ggplot() +
  geom_sf(data = spain, fill = "grey99", color = "grey30") +
  geom_point(data = df, aes(x = decimalLongitude, y = decimalLatitude),
             color = "darkgreen", size = 2, alpha = 0.7) +
  coord_sf() +
  theme_minimal()

```
#### Mapa plantas

```{r}
#| echo: true
#| fig-width: 9.5     # ancho en pulgadas
#| fig-height: 9  # alto en pulgadas
#| fig-align: "left"
library(FloraIberica)
map_distribution(genus = "Lavandula", species = "stoechas", size = 0.9)
```



## Visualizaciones geniales

[Valentina de Filippo](https://www.behance.net/valentinadefilippo?locale=es_ES)

